<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="icons/logoCKB.png" type="image/x-icon">
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/login.css" />
    <!-- <script src="js/main.js"></script> -->
    <script src="js/login.js"></script>
    <!-- <script src="js/profile.js"></script> -->
    <title>CKB: Login</title>
</head>

<body>
    <form action="#" id="login">
        <img src="icons/logoCKB.png" alt="">
        <h5>Welcome back to <span>CKB platform!</span></h5>
        <input type="email" name="email" id="email" placeholder="email">
        <input type="password" name="password" id="password" placeholder="password">
        <input type="button" id="loginButton" value="Log in">
        <h6 id="errorLogIn"></h6>
        <a onclick="register()">Don't have an account yet? create one</a>
    </form>
    <form action="/ckb_platform/register" method="post" id="register">
        <div>
            <img src="icons/logoCKB.png" alt="">
            <h5>Create an account in <span>CKB platform!</span></h5>
        </div>
        <input type="text" name="name" placeholder="Name" required>
        <input type="text" name="surname" placeholder="Surname" required>
        <input type="email" name="email" placeholder="email" required>
        <input type="text" name="uni" placeholder="Home university" required>
        <select title="Role"  name="role" required>
            <option value="EDU">Educator</option>
            <option value="STU">Student</option>
        </select>
        <input type="password" name="password" placeholder="password" required>
        <input type="password" name="password2" placeholder="confirm password" required>
        <div>
            <input type="checkbox" name="terms" id="terms" required>
            <label for="terms">I agree to the <a href="">Terms of Service</a> and <a href="">Privacy Policy</a></label>
        </div>
        <input type="button" value="Create new">
        <a onclick="login()">Already have an account? Log in</a>
    </form>

</body>

<!--Da spostare sul file di log in, a me se lo sposto sul file di login.js mi va solo in incognito altrimenti no -->
<script>
    var loginButton = document.getElementById('loginButton');

    loginButton.addEventListener('click', function () {
        console.log('Tentativo di login');

        // Ottieni i valori della form
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        console.log('Dati inseriti: ', {email, password});

        // Effettua la richiesta Fetch
        const url = 'http://localhost:8080/ckb_platform/login'; // Assicurati di usare il tuo URL effettivo
        const data = {email, password};

        const options = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        };

        fetch(url, options)
            .then(response => {
                //console.log('Dati ricevuti dal server:', data, response.body);

                switch (response.status) {
                    case 200:
                    case 302:
                        response.text().then(result => {
                            console.log(result);
                            window.location.href = result + ".html";
                        })
                        break;

                    case 400:
                    case 404:
                        response.text().then(result => {
                            console.log(result); // Questo sarÃ  il risultato della Promise
                            const errorBox = document.getElementById('errorLogIn');
                            console.log(errorBox); // Aggiungi questo log per debug
                            if (errorBox) {
                                errorBox.textContent = result;
                            }
                        })
                        break;

                    default:
                        const errorBox = document.getElementById('errorLogIn');
                        if (errorBox) {
                            errorBox.textContent = "Internal error";
                        }
                        break;
                }

            })
            .catch(error => {
                console.error('Errore durante la richiesta Fetch:', error);
            });
    })
</script>

</html>